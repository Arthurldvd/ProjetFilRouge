name: CI Pipeline

on:
 push:
   branches: [master, develop]
 pull_request:
   branches: [master, develop]


env:
 NODE_VERSION: '22'


jobs:


 backend-build:
   name: ğŸ—ï¸ Backend Build
   runs-on: ubuntu-latest
   defaults:
     run:
       working-directory: ./backend


   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Setup Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
         cache: 'npm'
         cache-dependency-path: backend/package-lock.json


     - name: Install dependencies
       run: npm ci


     - name: Build
       run: npm run build


 backend-test:
   name: ğŸ§ª Backend Tests
   runs-on: ubuntu-latest
   needs: [ backend-build]
   defaults:
     run:
       working-directory: ./backend


   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Setup Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
         cache: 'npm'
         cache-dependency-path: backend/package-lock.json


     - name: Install dependencies
       run: npm ci


     - name: Run unit tests with coverage
       run: npm run test:cov


     - name: Upload coverage report
       uses: actions/upload-artifact@v4
       with:
         name: backend-coverage
         path: backend/coverage
         retention-days: 7


 # ============================================
 # Frontend Jobs
 # ============================================
 frontend-build:
   name: ğŸ¨ Frontend Build
   runs-on: ubuntu-latest
   defaults:
     run:
       working-directory: ./frontend


   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Setup Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
         cache: 'npm'
         cache-dependency-path: frontend/package-lock.json


     - name: Install dependencies
       run: npm ci


     - name: Build
       run: npm run build


     - name: Upload build artifacts
       uses: actions/upload-artifact@v4
       with:
         name: frontend-dist
         path: frontend/dist
         retention-days: 7



